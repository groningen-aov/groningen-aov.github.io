<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>About - Groningen AAD Calculator</title>
    <meta
      name="description"
      content="About the Groningen GAM model for aortic annulus diameter prediction"
    />

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2060df" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="AOV About" />

    <!-- Pico.css Blue Theme -->
    <link rel="stylesheet" href="../style/pico.blue.min.css" />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="../style/style.css" />

    <link rel="manifest" href="../manifest.json" />
  </head>
  <body>
    <!-- Main container -->
    <!-- NAV -->
    <main class="container">
      <nav>
        <ul>
          <li><strong>Groningen AOV Calculator</strong></li>
        </ul>
        <ul>
          <li><a href="/" class="contrast">Home</a></li>
          <li><a href="/about/" class="contrast">About</a></li>
          <li><a href="/test/" class="contrast">Test</a></li>
          <li><a href="/batch/" class="contrast">Batch</a></li>
        </ul>
      </nav>

      <!-- Header -->
      <header>
        <hgroup>
          <h1>About the Groningen AOV Model</h1>
          <p>
            Predicting aortic annulus diameter from demographic and
            anthropometric data
          </p>
        </hgroup>
      </header>

      <!-- Model Overview -->
      <section>
        <article>
          <header>
            <h2>Model Overview</h2>
          </header>

          <p>
            The Groningen GAM (Generalized Additive Model) for aortic annulus
            diameter prediction is based on comprehensive analysis of
            <strong>75,142 cardiac-healthy organ donor records</strong>
            spanning from 1985 to 2016.
          </p>

          <h3>Key Features</h3>
          <ul>
            <li>
              <strong>Large Dataset:</strong> 75,142 donor records across all
              age groups (0-60 years)
            </li>
            <li>
              <strong>Modern Methodology:</strong> Generalized Additive Model
              with trilinear interpolation
            </li>
            <li>
              <strong>Comprehensive Coverage:</strong> Extends existing
              calculators limited to pediatric populations
            </li>
            <li>
              <strong>Contemporary Relevance:</strong> Addresses obesity
              epidemic by eliminating BSA constraints
            </li>
          </ul>
        </article>
      </section>

      <!-- Research Background -->
      <section>
        <article>
          <header>
            <h2>Research Background</h2>
          </header>

          <h3>Publication</h3>
          <blockquote>
            <strong
              >"Modeling the expected aortic annulus diameter from 75,142 donor
              records: a new standard for normalization in children and
              adults."</strong
            >
            <br /><br />
            <em>Authors:</em> Joost P van Melle<sup>1</sup>*, Leah
            Dijkshoorn<sup>2</sup>*, Marco A Grzegorczyk<sup>2</sup>, Dan
            Dyar<sup>3</sup>, Tjark Ebels<sup>4</sup>, Gerton Lunter<sup>5</sup>
            <br />
            <small>*These authors contributed equally</small>
          </blockquote>

          <h3>Institutional Affiliations</h3>
          <ol>
            <li>
              <strong>Department of Cardiology</strong> - University Medical
              Centre Groningen
            </li>
            <li>
              <strong>Statistics and Probability Group</strong> - Bernoulli
              Institute, University of Groningen
            </li>
            <li>
              <strong>Department of Cardiology</strong> - University of
              California, San Diego
            </li>
            <li>
              <strong>Department of Cardiothoracic Surgery</strong> - University
              Medical Center Groningen
            </li>
            <li>
              <strong>Department of Epidemiology</strong> - University Medical
              Centre Groningen
            </li>
          </ol>
        </article>
      </section>

      <!-- How to Cite Section -->
      <section id="citation">
        <article>
          <header>
            <h2>How to Cite</h2>
          </header>

          <p>
            When using this calculator in research, clinical studies, or
            publications, please cite the underlying research and methodology.
          </p>

          <div class="citation-box">
            <h3>Citation</h3>
            <blockquote>
              <strong
                >van Melle JP, Dijkshoorn L, Grzegorczyk MA, Dyar D, Ebels T,
                Lunter G.</strong
              ><br />
              "Modeling the expected aortic annulus diameter from 75,142 donor
              records: a new standard for normalization in children and
              adults."<br />
              <em>[Journal Name]. [Year];[Volume]([Issue]):[Pages].</em>
            </blockquote>

            <details style="margin-top: 1rem">
              <summary><strong>BibTeX Format</strong></summary>
              <pre
                style="
                  background: var(--pico-card-sectioning-background-color);
                  padding: 1rem;
                  border-radius: var(--pico-border-radius);
                  margin-top: 0.5rem;
                  font-size: 0.875rem;
                "
              >
@article{vanmelle2024aortic,
  title={Modeling the expected aortic annulus diameter from 75,142 donor records: a new standard for normalization in children and adults},
  author={van Melle, Joost P and Dijkshoorn, Leah and Grzegorczyk, Marco A and Dyar, Dan and Ebels, Tjark and Lunter, Gerton},
  journal={[Journal Name]},
  volume={[Volume]},
  number={[Issue]},
  pages={[Pages]},
  year={[Year]},
  publisher={[Publisher]}
}</pre
              >
            </details>
          </div>

          <div
            style="
              background: var(--pico-ins-background-color);
              color: var(--pico-ins-color);
              padding: 1rem;
              border-radius: var(--pico-border-radius);
              margin-top: 1rem;
            "
          >
            <strong>Note:</strong> Citation details will be updated once the
            article is published. For current research, please reference this
            calculator as "Groningen AAD Calculator" and include the URL:
            <code>https://groningen-aov.github.io</code>
          </div>
        </article>
      </section>

      <!-- Clinical Applications -->
      <section>
        <article>
          <header>
            <h2>Clinical Applications</h2>
          </header>

          <h3>Primary Use Cases</h3>
          <ul>
            <li>
              <strong>Aortic Valve Replacement:</strong> Selecting appropriate
              prosthesis size
            </li>
            <li>
              <strong>Congenital Heart Surgery:</strong> Planning reconstructive
              procedures
            </li>
            <li>
              <strong>Research Applications:</strong> Normalizing measurements
              across populations
            </li>
            <li>
              <strong>Quality Assurance:</strong> Validating echocardiographic
              measurements
            </li>
          </ul>

          <h3>Individual vs. Batch Processing</h3>
          <p>
            This calculator offers two processing modes to accommodate different
            clinical and research workflows:
          </p>
          <ul>
            <li>
              <strong>Individual Calculator:</strong> Single-patient
              calculations for clinical decision making
            </li>
            <li>
              <strong><a href="/batch/">Batch Data Processing</a>:</strong>
              High-performance processing of large datasets (tested with 10,000+
              patients) for research studies, quality assurance projects, and
              population-level analysis
            </li>
          </ul>

          <h3>Model Inputs</h3>
          <ul>
            <li>
              <strong>Age:</strong> 0-59 years (supports days, weeks, months,
              years)
            </li>
            <li><strong>Weight:</strong> 1.34-352 kg</li>
            <li><strong>Height:</strong> 30-236 cm</li>
            <li><strong>Sex:</strong> Male or Female</li>
            <li><strong>Measured AAD:</strong> for Z-score calculation</li>
          </ul>

          <h3>Model Outputs</h3>
          <ul>
            <li><strong>Expected AAD:</strong> Predicted mean diameter (mm)</li>
            <li>
              <strong>Standard Deviation:</strong> Population variability (mm)
            </li>
            <li><strong>Normal Range:</strong> Â±2 standard deviations</li>
            <li><strong>Z-Score:</strong> When measured value provided</li>
          </ul>
        </article>
      </section>

      <!-- Technical Implementation -->
      <section>
        <article>
          <header>
            <h2>Technical Implementation</h2>
          </header>

          <h3>Model Architecture</h3>
          <p>
            The calculator implements the original R-based GAM model using
            JavaScript with trilinear interpolation across a pre-computed grid
            of predictions. This approach ensures mathematical consistency with
            the original research while providing fast, offline-capable
            calculations.
          </p>

          <h3>Data Transformations</h3>
          <ul>
            <li><strong>Weight:</strong> log(weight) transformation</li>
            <li><strong>Height:</strong> sqrt(height) transformation</li>
            <li><strong>Age:</strong> log(age + 1) transformation</li>
          </ul>

          <h3>Quality Assurance</h3>
          <p>
            All calculations are validated against the original R model with
            comprehensive test cases spanning the full range of input
            parameters. The implementation maintains precision within 0.001
            tolerance of the reference implementation.
          </p>

          <h3>Performance</h3>
          <p>
            The batch processing system delivers high-performance calculations
            suitable for large-scale research, with processing speeds of over
            4,000 patients per second on modern hardware.
          </p>
        </article>
      </section>

      <!-- Limitations and Considerations -->
      <section>
        <article>
          <header>
            <h2>Limitations and Considerations</h2>
          </header>

          <h3>Clinical Limitations</h3>
          <ul>
            <li>
              <strong>Population Basis:</strong> Based on cardiac-healthy organ
              donors
            </li>
            <li><strong>Age Range:</strong> Limited to 0-59 years</li>
            <li>
              <strong>Geographic Scope:</strong> Derived from donor population
              (geographic distribution not specified)
            </li>
            <li>
              <strong>Decision Support:</strong> For clinical decision support
              only, not diagnostic
            </li>
          </ul>

          <h3>Technical Considerations</h3>
          <ul>
            <li>
              <strong>Interpolation Accuracy:</strong> Results are interpolated
              from grid points
            </li>
            <li>
              <strong>Boundary Conditions:</strong> Extreme values may have
              reduced accuracy
            </li>
            <li>
              <strong>Model Assumptions:</strong> GAM assumptions apply to
              predictions
            </li>
          </ul>

          <div
            style="
              background: var(--pico-muted-background-color);
              padding: 1rem;
              border-radius: var(--pico-border-radius);
              margin-top: 1rem;
            "
          >
            <strong>Important:</strong> This calculator is intended for clinical
            decision support only. Always verify results with institutional
            protocols and consider individual patient factors when making
            clinical decisions.
          </div>
        </article>
      </section>

      <!-- PWA Features -->
      <section>
        <article>
          <header>
            <h2>Application Features</h2>
          </header>

          <h3>Privacy and Security</h3>
          <ul>
            <li>
              <strong>No Data Collection:</strong> No patient data is
              transmitted or stored
            </li>
            <li>
              <strong>Local Processing:</strong> All calculations performed on
              device
            </li>
            <li>
              <strong>Open Source:</strong> Transparent implementation available
              for review
            </li>
          </ul>

          <h3>Progressive Web App</h3>
          <ul>
            <li>
              <strong>Offline Capability:</strong> Works without internet
              connection after initial load
            </li>
            <li>
              <strong>Mobile Optimized:</strong> Responsive design for tablets
              and smartphones
            </li>
            <li>
              <strong>Installable:</strong> Can be installed on device home
              screen
            </li>
            <li>
              <strong>Fast Loading:</strong> Cached resources for instant
              startup
            </li>
          </ul>

          <h3 id="status">Application Status</h3>

          <!-- Offline vs Install Explanation -->
          <div
            style="
              background: var(--pico-card-sectioning-background-color);
              padding: 1rem;
              border-radius: var(--pico-border-radius);
              margin-bottom: 1.5rem;
            "
          >
            <p>
              <strong>How Offline Works:</strong> This app automatically works
              offline after your first visit - no installation required! The
              service worker caches all pages and calculations in your browser.
            </p>
            <p>
              <strong>Installing as PWA:</strong> Optional installation adds a
              home screen icon and opens the app in a standalone window for a
              more native app-like experience, but offline functionality works
              either way.
            </p>
          </div>

          <div class="status-container">
            <div class="status-item">
              <h4>ð Connection Status</h4>
              <div id="connection-status" class="status-indicator">
                <span class="status-dot">âª</span>
                <span class="status-text">Checking...</span>
              </div>
              <p>
                <small
                  >Current internet connectivity and service
                  availability.</small
                >
              </p>
            </div>

            <div class="status-item">
              <h4>ð± Offline Capability</h4>
              <div id="offline-status" class="status-indicator">
                <span class="status-dot">âª</span>
                <span class="status-text">Checking...</span>
              </div>
              <p><small>Ability to work without internet connection.</small></p>
            </div>

            <div class="status-item">
              <h4>â¬ï¸ PWA Installation</h4>
              <div id="pwa-status" class="status-indicator">
                <span class="status-dot">âª</span>
                <span class="status-text">Checking...</span>
              </div>
              <p><small>Home screen installation availability.</small></p>
            </div>
          </div>

          <h4>Status Indicators</h4>
          <ul>
            <li>
              <strong>ð¢ Ready/Available:</strong> Feature is working or
              available
            </li>
            <li>
              <strong>ð¡ Limited/Installing:</strong> Partial functionality or
              in progress
            </li>
            <li>
              <strong>ð´ Unavailable:</strong> Feature not supported or
              connection issues
            </li>
            <li><strong>âª Checking:</strong> Status being determined</li>
          </ul>

          <details>
            <summary>Installation Benefits</summary>
            <div style="margin-top: 0.5rem">
              <p><strong>Installing this app gives you:</strong></p>
              <ul>
                <li>
                  <strong>Home screen icon</strong> - Quick access like a native
                  app
                </li>
                <li>
                  <strong>Faster startup</strong> - Optimized loading on mobile
                  devices
                </li>
                <li>
                  <strong>Offline capability</strong> - Can launch offline
                  from home screen
                </li>
              </ul>
              <p>
                <small
                  ><em
                    >To install: Look for "Add to Home Screen" or install icon
                    in your browser.</em
                  ></small
                >
              </p>
            </div>
          </details>

          <details>
            <summary>Technical Details</summary>
            <div id="technical-status">
              <p>
                <strong>Service Worker Support:</strong>
                <span id="sw-support">Checking...</span>
              </p>
              <p>
                <strong>Cache Storage:</strong>
                <span id="cache-support">Checking...</span>
              </p>
              <p>
                <strong>Installation Prompt:</strong>
                <span id="install-prompt">Checking...</span>
              </p>
              <p>
                <strong>Last Updated:</strong>
                <span id="last-check">Never</span>
              </p>
              <p>
                <strong>User Agent:</strong>
                <code id="user-agent">Loading...</code>
              </p>
            </div>
          </details>
        </article>
      </section>
    </main>

    <!-- Footer -->
    <footer class="container">
      <small>
        <p>
          <em
            >For clinical decision support only. Always verify with
            institutional protocols.</em
          >
        </p>
      </small>
    </footer>

    <!-- Version management -->
    <script src="../js/version.js"></script>

    <style>
      .citation-box {
        background: var(--pico-card-sectioning-background-color);
        padding: 1.5rem;
        border-radius: var(--pico-border-radius);
        border-left: 4px solid var(--pico-primary);
        margin: 1rem 0;
      }

      .citation-box h3 {
        margin-top: 0;
        color: var(--pico-primary);
      }

      .citation-box blockquote {
        margin-bottom: 0;
        border-left: none;
        padding-left: 0;
        background: none;
      }

      #citation {
        scroll-margin-top: 2rem;
      }

      /* Status section styles */
      .status-container {
        display: grid;
        gap: 1rem;
        margin: 1.5rem 0;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }

      .status-item {
        padding: 1rem;
        border-radius: var(--pico-border-radius);
        border: var(--pico-border-width) solid var(--pico-border-color);
        background: var(--pico-card-background-color);
      }

      .status-item h4 {
        margin: 0 0 0.5rem 0;
        font-size: 1rem;
      }

      .status-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 0.5rem 0;
      }

      .status-dot {
        font-size: 1.2rem;
      }

      .status-text {
        font-weight: 600;
      }

      #technical-status code {
        word-break: break-all;
        font-size: 0.8rem;
      }

      /* Mobile responsive adjustments for status */
      @media (max-width: 768px) {
        .status-container {
          grid-template-columns: 1fr;
        }
      }
    </style>

    <script>
      // Enhanced status checking functionality
      let installPromptEvent = null;

      // Capture install prompt for later use
      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        installPromptEvent = e;
      });

      function updateAboutPageStatus() {
        // Connection Status
        const connectionStatus = document.getElementById("connection-status");
        if (connectionStatus) {
          const dot = connectionStatus.querySelector(".status-dot");
          const text = connectionStatus.querySelector(".status-text");

          if (navigator.onLine) {
            dot.textContent = "ð¢";
            text.textContent = "Online";
          } else {
            dot.textContent = "ð´";
            text.textContent = "Offline";
          }
        }

        // Offline Capability Status
        const offlineStatus = document.getElementById("offline-status");
        if (offlineStatus) {
          const dot = offlineStatus.querySelector(".status-dot");
          const text = offlineStatus.querySelector(".status-text");

          if ("serviceWorker" in navigator) {
            if (navigator.serviceWorker.controller) {
              dot.textContent = "ð¢";
              text.textContent = "Ready (works offline)";
            } else {
              // Service worker supported but not yet active
              navigator.serviceWorker.ready
                .then((registration) => {
                  if (registration.active) {
                    dot.textContent = "ð¢";
                    text.textContent = "Ready (works offline)";
                  } else {
                    dot.textContent = "ð¡";
                    text.textContent = "Loading offline capability";
                  }
                })
                .catch(() => {
                  dot.textContent = "ð¡";
                  text.textContent = "Loading offline capability";
                });
            }
          } else {
            dot.textContent = "ð´";
            text.textContent = "Not supported";
          }
        }

        // PWA Installation Status
        const pwaStatus = document.getElementById("pwa-status");
        if (pwaStatus) {
          const dot = pwaStatus.querySelector(".status-dot");
          const text = pwaStatus.querySelector(".status-text");

          // Check if already installed (running in standalone mode)
          if (
            window.matchMedia &&
            window.matchMedia("(display-mode: standalone)").matches
          ) {
            dot.textContent = "ð¢";
            text.textContent = "Installed";
          } else if (
            installPromptEvent ||
            window.navigator.standalone !== undefined || // iOS Safari
            window.matchMedia("(display-mode: browser)").matches
          ) {
            dot.textContent = "ð¢";
            text.textContent = "Available to install";
          } else {
            // Check if browser supports PWA installation
            if ("serviceWorker" in navigator && "PushManager" in window) {
              dot.textContent = "ð¡";
              text.textContent = "May be installable";
            } else {
              dot.textContent = "ð´";
              text.textContent = "Not supported";
            }
          }
        }

        // Technical Details
        const swSupport = document.getElementById("sw-support");
        if (swSupport) {
          swSupport.textContent = "serviceWorker" in navigator ? "Yes" : "No";
        }

        const cacheSupport = document.getElementById("cache-support");
        if (cacheSupport) {
          cacheSupport.textContent = "caches" in window ? "Yes" : "No";
        }

        const installPromptStatus = document.getElementById("install-prompt");
        if (installPromptStatus) {
          if (
            window.matchMedia &&
            window.matchMedia("(display-mode: standalone)").matches
          ) {
            installPromptStatus.textContent = "Already installed";
          } else if (installPromptEvent) {
            installPromptStatus.textContent = "Available";
          } else {
            installPromptStatus.textContent = "Not available";
          }
        }

        const lastCheck = document.getElementById("last-check");
        if (lastCheck) {
          lastCheck.textContent = new Date().toLocaleString();
        }

        const userAgent = document.getElementById("user-agent");
        if (userAgent) {
          userAgent.textContent = navigator.userAgent;
        }
      }

      // Update status when page loads and on various events
      document.addEventListener("DOMContentLoaded", () => {
        // Small delay to let service worker settle
        setTimeout(updateAboutPageStatus, 1000);

        // Check again after a bit more time for service worker registration
        setTimeout(updateAboutPageStatus, 3000);
      });

      // Listen for service worker changes
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.addEventListener(
          "controllerchange",
          updateAboutPageStatus
        );
      }

      // Network status changes
      window.addEventListener("online", updateAboutPageStatus);
      window.addEventListener("offline", updateAboutPageStatus);

      // App install/uninstall events
      window.addEventListener("appinstalled", updateAboutPageStatus);

      // Update status every 30 seconds for live monitoring
      setInterval(updateAboutPageStatus, 30000);
    </script>
  </body>
</html>
